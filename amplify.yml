version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Pull submodules (theme) first
        - git submodule sync --recursive
        - git submodule update --init --recursive
        - git submodule status --recursive

        # Install Hugo Extended (match local)
        - export HUGO_VER=0.151.2
        - curl -sSL -o hugo.tar.gz https://github.com/gohugoio/hugo/releases/download/v${HUGO_VER}/hugo_extended_${HUGO_VER}_Linux-64bit.tar.gz
        - tar -xzf hugo.tar.gz
        - chmod +x ./hugo
        - ./hugo version

        # Production env
        - export HUGO_ENV=production
    build:
      commands:
        - ./hugo --gc --minify --cleanDestinationDir --environment production
  artifacts:
    baseDirectory: public
    files:
      - '**/*'
  cache:
    paths: []
