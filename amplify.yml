version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Ensure submodules are pulled (and follow nested submodules, if any)
        - git submodule sync --recursive
        - git submodule update --init --recursive

        # Install Hugo Extended (your current approach)
        - export HUGO_VER=0.143.1   # keep in sync with your local
        - curl -sSL -o hugo.tar.gz https://github.com/gohugoio/hugo/releases/download/v${HUGO_VER}/hugo_extended_${HUGO_VER}_Linux-64bit.tar.gz
        - tar -xzf hugo.tar.gz
        - chmod +x ./hugo
        - export PATH=$PWD:$PATH
        - ./hugo version

        # (Optional, but helps some themes) set production env
        - export HUGO_ENV=production
    build:
      commands:
        - ./hugo --gc --minify
  artifacts:
    baseDirectory: public
    files:
      - '**/*'
  cache:
    paths: []
